# fpm与nginx动态平衡压测组件
## 压测端
### 启动脚本
* 使用php开发，实现以下功能
    1. 坡度——平滑交替加压(目前只有坡度)，每次坡度上升持续5min，每次平滑持续2min
    2. 外界传入配置，控制起始、最高以及坡度等并发参数
    3. 结果存入数据库，输出观察图表
### 数据库初始脚本
* 用于存放压测项目，与模拟结果，内容存放于database目录下
### 压测平台(beta) 
* 基于yii2搭建的简易压测平台，用于辅助记录与查看

## 被压端
### 配置变更
    1. 设置并预设php与nginx的初始配置，可参考php_conf与nginx_conf文件夹中的basic文件
    2. 在kubernetes平台上部署服务，通过config-map控制conf文件内容(注意，windows下复制过去的内容，nginx配置必须添加换行符\n，否则文件创建时解析不正确)
    3. 执行压测脚本，在grafana上根据pod查看cpu与memory性能，可根据container_name对数据进行聚合，查看每个pod下的对应container的性能消耗
    4. 按照fpm优化——fpm容器增加——nginx优化——容器资源增加的顺序，逐步调整并优化配置
### 模拟环境
    1. 正常情况使用下，回压测正式的业务，此环境仅供模拟，衡量fpm与nginx的资源动态平衡
    2. 目前包括以下情况的模拟
        * 通用的延迟业务，时间范围随机200ms~400ms
        * 高CPU计算
        * 高文件I/O
        * 大文件上传与下载接口

### 注意
    1. 压测时输入的url，配置中&需要转义
    2. wrk的工具请去官网下载，并放在根目录下，命名为wrk
